## ImageTransformer

  

Сервис решающет следующую задачу: по HTTP приходит запрос, содержащий картинку в формате png, координаты прямоугольной области и название фильтра. Надо применить к картинке фильтр, вырезать фрагмент, соответствующий заданной области, и отправить в ответ.
  

Сборка: nuget restore && msbuild /p:Configuration=Release  

Сервис принимает запросы на префиксе http://+:8080/, например http://localhost:8080/process/grayscale/0,0,20,20

### API

Поддерживается единственный запрос:

POST /process/&lt;filter&gt;/&lt;coords&gt;

  

Body: данные изображения в формате png.

Размер изображения не должен превышать 100KB. 

Если в запросе изображение большего размера — отправляется пустой ответ с кодом 400 Bad Request.


&lt;filter&gt; — строка grayscale, sepia или threshold(x), где x — целое число от 0 до 100 включительно.

Пример корректной строки &lt;filter&gt;: threshold(30)

Если &lt;filter&gt; не соответствует этому формату — отправляется пустой ответ с кодом 400 Bad Request.

&lt;coords&gt; — строка вида x,y,w,h, где x и y — целые числа, задающие координаты левого верхнего угла прямоугольника, w и h — целые числа, задающие ширину и высоту прямоугольника.

  

Координаты отсчитываются от левого верхнего угла изображения (левый верхний пиксель имеет координаты 0, 0). Все 4 числа могут быть отрицательными, при этом каждое из них по модулю не превышает 231. Если прямоугольник выходит за границу изображения, он должен быть обрезан по границе изображения.

  

Пример корректной строки &lt;coords&gt; для изображения размером 100x100: -5,-30,200,50

В этом случае в ответ должна попасть область изображения 0,0,100,20.

  

Если пересечение прямоугольника с изображением пустое — отправляется пустой ответ с кодом 204 No Content.

Если &lt;coords&gt; имеет неправильный формат — отправляется пустой ответ с кодом 400 Bad Request. 

Если сервис получает запрос другого формата — отправляется пустой ответ с кодом 400 Bad Request.

### Фильтры

  

Фильтры преобразуют каждый пиксель изображения по описанным правилам. Если в изображении есть альфа-канал, он должен остаться без изменений.

  

Все операции производятся в целых числах, если не сказано иное.

  

#### grayscale

  

intensity = (oldR + oldG + oldB) / 3

  

R = intensity

G = intensity

B = intensity

  

#### threshold(x)

  

intensity = (oldR + oldG + oldB) / 3

  

if intensity &gt;= 255 * x / 100

R = 255

G = 255

B = 255

else

R = 0

G = 0

B = 0

  

#### sepia

  

Здесь используется single-precision арифметика (float в C#). При присвоении новых значений компонентам цвета дробная часть отбрасывается, если число получилось больше 255 — оно заменяется на 255.

  

R = (oldR * .393) + (oldG * .769) + (oldB * .189)

G = (oldR * .349) + (oldG * .686) + (oldB * .168)

B = (oldR * .272) + (oldG * .534) + (oldB * .131)

### Примечание

Список latencies хранится с целью динамического анализа времени, необходимого сервису на обработку запроса. Если это время становится слишком долгим, запросы начинают отклоняться до тех пор, пока обработка запросов не станет достаточно быстрой(из вариантов "обслужить не всех, но быстро" и "обслужить всех, но долго" выбран первый).